# Laboratoire 16 ğŸ’©

<center>![BanniÃ¨re du site](../../static/img/labo15/banner.png)</center>

Un [projet de dÃ©part](../../static/files/labo15.zip) Angular et ASP.NET Core vous sont fournis.

**Mise en situation dont personne n'avait besoin** : M. Robidoux gÃ¨re un zoo de dinosaures, mais il a besoin d'un systÃ¨me pour rÃ©pertorier tous les incidents qui surviennent pour simplifier la collaboration avec ses assureurs.

Vous devrez complÃ©ter le systÃ¨me existant, essentiellement en implÃ©mentant la crÃ©ation (Post) de `zookeeper`, de `dinosaur` et d'`incident` ainsi que la suppression (Delete) de `zookeeper` et de `dinosaur`. Comme ces entitÃ©s ont des relations, Ã§a pourrait Ãªtre dÃ©licat.

## ğŸ˜µ Qu'est-ce qui se passe ici

Commencez par jeter un coup d'oeil aux deux projets. Portez principalement attention aux classes `Zookeeper`, `Dinosaur` et `Incident`. Assurez-vous de bien comprendre le type de relation entre chacune de ses classes.

En rÃ©sumÃ© :
* Un `Zookeeper` est responsable de plusieurs `Dinosaur`.
* Un `Dinosaur` est gÃ©rÃ© par un `Zookeeper` et est associÃ© Ã  plusieurs `Incident`.
* Un `Incident` est associÃ© Ã  plusieurs `Dinosaur`.

## ğŸ¥š Donner naissance est difficile

### 1 - CrÃ©er des zookeepers

CrÃ©ez une action `Post` dans `ZookeepersController` permettant de crÃ©er des nouveaux gardiens.

Il faudra aussi complÃ©ter une requÃªte dans le `DinosaurService` **cÃ´tÃ© client**.

Bien que `Zookeeper` ait une relation avec `Dinosaur`, comme un `Zookeper` peut exister sans `Dinosaur`,
Ã§a devrait Ãªtre _ultra simple_ et ressembler Ã  un `Post` auto-gÃ©nÃ©rÃ©.

<center>![Liste de gardiens](../../static/img/labo15/zookeepers.png)</center>

### 2 - CrÃ©er des dinosaures

CrÃ©ez une action `Post` dans `DinosaursController` permettant de crÃ©er des nouveaux dinosaures.

Il faudra aussi complÃ©ter une requÃªte dans le `DinosaurService` **cÃ´tÃ© client**.

[ğŸ’¡](/cours/rencontre8.1#-crÃ©ation) Comme un `Dinosaur` doit absolument Ãªtre associÃ© Ã  un `Zookeeper` dÃ¨s sa crÃ©ation, il faudra aussi transmettre l'id du `Zookeeper` associÃ©.

[ğŸ’¡](/cours/rencontre8.1#-data-transfer-objects) Vous aurez besoin d'un DTO pour y arriver.

<center>![Liste de dinosaures](../../static/img/labo15/dinosaurs.png)</center>

### 3 - CrÃ©er des incidents

CrÃ©ez une action `Post` dans `IncidentsController` permettant de crÃ©er des nouveaux incidents.

Il faudra aussi complÃ©ter une requÃªte dans le `DinosaurService` **cÃ´tÃ© client**.

[ğŸ’¡](/cours/rencontre8.1#-crÃ©ation) Lors de la crÃ©ation d'un `Incident`, nous voudrons **immÃ©diatement** indiquer Ã  quels `Dinosaur` cet `Incident` est associÃ©. Il faudra donc envoyer la liste des ids des `Dinosaur` associÃ©s au serveur.

[ğŸ’¡](/cours/rencontre8.1#-data-transfer-objects) Vous aurez besoin d'un DTO pour y arriver.

<center>![Liste d'incidents](../../static/img/labo15/incidents.png)</center>

## ğŸ”ª Supprimer n'est pas plus facile

### 4 - Supprimer des dinosaures

[ğŸ’¡](/cours/rencontre8.1#-suppression) Lorsqu'on supprime un `Dinosaur`, on doit aussi supprimer tous ses `Incident` associÃ©s **SI CE DINOSAURE Ã‰TAIT LE DERNIER Ã‰TANT ASSOCIÃ‰ Ã€ L'INCIDENT** (Il faudra un petit `if` avec `maListe.Count == 1` par exemple !), sinon on laisse dans la base de donnÃ©es un `Indicent` un peu inutile.

CrÃ©ez une action `Delete` dans le `DinosaursController` **cÃ´tÃ© serveur** et complÃ©tez le `DinosaurService` **cÃ´tÃ© client**.

### 5 - Supprimer des zookeepers

[ğŸ’¡](/cours/rencontre8.1#-suppression) Lorsqu'on supprime un `Zookeeper`, on doit aussi supprimer tous ses `Dinosaur` associÃ©s, sinon il y aura une erreur en lien avec une **clÃ© Ã©trangÃ¨re** dans la base de donnÃ©es. 

Comme pour la **question prÃ©cÃ©dente**, il faudra encore supprimer certains `Incident` si un `Dinosaur` associÃ© qu'on s'apprÃªte Ã  supprimer Ã©tait le **dernier associÃ© Ã  l'incident**. 

CrÃ©ez une action `Delete` dans le `ZookeepersController` **cÃ´tÃ© serveur** et complÃ©tez le `DinosaurService` **cÃ´tÃ© client**.

## âš™ Rendez-vous service en utilisant les services

:::warning

C'est important de se pratiquer Ã  utiliser des services, mais pour allÃ©ger le code, il y aura seulement des services dans le TP3 et dans le TP4. (Les prochains labos et l'examen final n'auront pas de services)

:::

### 6 - ComplÃ©ter trois services

[ğŸ’¡](/cours/rencontre8.1#-services) Pour chacune des trois entitÃ©s qui existent, complÃ©tez un **service**. L'objectif est de retirer le `DbContext` des trois contrÃ´leurs. 

:::info

Vous risquez d'avoir environ **9+ mÃ©thodes** Ã  crÃ©er dans vos 3 services. (Au total) Ã‡a peut sembler long, mais il s'agit principalement de **dÃ©placer du code** et de **dÃ©couper des mÃ©thodes**. Vous pouvez vous inspirer des services dans les notes de cours, mais il y aura quelques diffÃ©rences.

Gardez Ã  l'esprit que le plus important est de **dÃ©barrasser toutes les lignes de code impliquant `_context` des contrÃ´leurs**.

:::

Ci-dessous, quelques pistes pour chacune des 7 actions existantes dans vos contrÃ´leurs :

1. `GetZookeeper`Â et `GetDinosaur`

Pour ces deux actions, il suffira de crÃ©er une mÃ©thode `GetAll()` dans `ZookeeperService` et `DinosaurService`. **100% copiÃ©-collÃ© des notes de cours**.

<hr/>

2. `PostZookeeper`

PlutÃ´t simple aussi, il suffira de crÃ©er une mÃ©thode `Create()` dans `ZookeeperService`. **100% copiÃ©-collÃ© des notes de cours**.

<hr/>

3. `PostDinosaur`

Vous aurez besoin de deux mÃ©thodes dans les services :

* `Get()` (ou _GetOne_) dans `ZookeeperService` pour obtenir le `Zookeeper` responsable du `Dinosaur`.
* `Create()` dans `DinosaurService`.

Ã‡a veut dire que deux services seront injectÃ©s dans `DinosaursController`.

<hr/>

4. `PostIncident`

Vous aurez besoin de deux mÃ©thodes dans les services :

* `Get()` (Un _GetOne_) dans `DinosaurService` pour obtenir chaque `Dinosaur` dont l'`id` a Ã©tÃ© reÃ§u.
* `Create()` dans `IncidentService`.

Ã‡a veut dire que deux services seront injectÃ©s dans `IncidentsController`.

<hr/>

5. `DeleteDinosaur`

Vous aurez besoin d'**une Ã  trois** mÃ©thodes dans les services :

* `Delete()` dans `DinosaurService`. Comme il y aura une boucle qui supprime des `Incident`, on a deux choix... :
  * Soit on encapsule cette boucle dans la mÃ©thode `Delete()` de `DinosaurService()` (Plus simple)
  * Soit on crÃ©e un `Get()` ET un `Delete()` dans `IncidentService`. (Plus complexe)

<hr/>

6. `DeleteZookeeper`

Vous aurez besoin d'**une Ã  quatre** mÃ©thodes dans les services :

* `Delete()` dans `ZookeeperService`. Encore une fois, pour la boucle, on a deux choix... :
  * On la met dans le `Delete()`Â de `ZookeeperService` (Moins bien... â›”)
  * On utilise `Get()` et `Delete()`Â dans `DinosaurService`. (Mieux ! âœ…) Si vous faites ceci, vous aurez aussi besoin d'un `Get()` dans `ZookeeperService` pour commencer par obtenir le `Zookeeper` avant la boucle.

:::info

Gardez Ã  l'esprit qu'il y a plusieurs maniÃ¨res de dÃ©couper les fonctionnalitÃ©s dans les services... L'important est de **dÃ©barrasser le DbContext des contrÃ´leurs** ET d'Ã©viter la **rÃ©pÃ©tition de code** dans les contrÃ´leurs.

:::


