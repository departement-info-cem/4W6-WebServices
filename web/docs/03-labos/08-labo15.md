# Laboratoire 15

Un [projet de dÃ©part](../../static/files/labo15.zip) Next.js vous est fourni pour ce labo. Vous devrez crÃ©er le projet ASP.NET Core Web API vous-mÃªmes cela dit.

## ğŸ«ƒ Ma premiÃ¨re Web API

### 1 - CrÃ©ation du projet

[ğŸ’¡](/notes/rencontre8.1#-serveur-web-api-simple) CrÃ©ez un projet ASP.NET Core Web API avec la version .NET 8 nommÃ© `labo14_serveur`.

Suivez toutes les Ã©tapes des notes de cours bÃªtement et arrÃªtez vous juste avant la **crÃ©ation du modÃ¨le**.

### 2 - CrÃ©ation d'un modÃ¨le

[ğŸ’¡](/notes/rencontre8.1#-modÃ¨le) CrÃ©ez un modÃ¨le `Item.cs` avec les propriÃ©tÃ©s suivantes :

* Id (int) -> Ex. 2
* Name (string) -> Ex. "Silencieux dâ€™automobile"
* Value (int) -> Ex. 80

### 3 - CrÃ©ation d'un contrÃ´leur

[ğŸ’¡](/notes/rencontre8.1#-contrÃ´leur) CrÃ©ez un contrÃ´leur avec des actions auto-gÃ©nÃ©rÃ©es pour ce modÃ¨le.

ExÃ©cutez ensuite votre application et vÃ©rifiez que Swagger affiche les informations des requÃªtes de ce nouveau contrÃ´leur. (Lâ€™ordre des requÃªtes pourrait Ãªtre diffÃ©rent)

<p align="center">
    <img src={require('../../static/img/labo14/swagger1.png').default} width="40%" alt="Interface Swagger"/>
</p>

## ğŸš— Faire fausse route

Nous allons modifier quelques routes dans `ItemsController`.

### 4 - Utiliser une rÃ¨gle globale

[ğŸ’¡](/notes/rencontre8.1#-rÃ¨gles-globales) Changez la rÃ¨gle globale de routage de votre contrÃ´leur pour que le nom des actions soit inclus dans les URL de requÃªte.

### 5 - Utiliser une rÃ¨gle spÃ©cifique

[ğŸ’¡](/notes/rencontre8.1#-rÃ¨gles-par-action) Ajoutez une rÃ¨gle spÃ©cifique Ã  lâ€™action `Delete` pour que lâ€™url de requÃªte soit `localhost:port/api/destroy`.

De plus, changez la mÃ©thode de l'action pour que ce soit `POST` plutÃ´t que `DELETE`. (Le code Ã  l'intÃ©rieur de lâ€™action doit rester identique, cela servira encore Ã  supprimer un Item de la base de donnÃ©es. On sâ€™amuse juste Ã  changer le type de mÃ©thode / requÃªte pour se rendre compte quâ€™on peut en faire ce quâ€™on veut)

Si vous exÃ©cutez Ã  nouveau le serveur, vous devriez avoir ceci :

<center>![Interface Swagger](../../static/img/labo14/swagger2.png)</center>

## ğŸ’¿ SQL c'est plate smh

### 6 - GÃ©nÃ©rer la base de donnÃ©es

[ğŸ’¡](/notes/rencontre8.1#-base-de-donnÃ©es) Faites toutes les Ã©tapes nÃ©cessaires pour gÃ©nÃ©rer une base de donnÃ©es qui pourra contenir des objets de type `Item`. Remerciez au passage `Entity Framework` pour l'opportunitÃ© de ne pas Ã©crire la moindre ligne de SQL aujourd'hui.

## ğŸ–¥ React ? Ã‡a ne me dit rien

Faites le nÃ©cessaire pour ouvrir et exÃ©cuter le projet Next.js fourni. La classe `Item` existe dÃ©jÃ  dans le projet Next.js. Si vous avez bien respectÃ© les noms indiquÃ©s plus tÃ´t pour la classe `Item` cÃ´tÃ© serveur, tout devrait bien fonctionner plus tard.

### 7 - CrÃ©er 5 requÃªtes

Vous aurez seulement Ã  modifier le hook `useItemAPI`, dans lequel les 5 requÃªtes seront centralisÃ©es. Il n'y aura rien Ã  changer dans le composant `Home`, le **hook** est dÃ©jÃ  bien intÃ©grÃ© et exploitÃ©.

Pour les implÃ©mentations qui suivent, nâ€™hÃ©sitez pas Ã  jeter un coup dâ€™Å“il Ã  **lâ€™interface Swagger** en exÃ©cutant votre serveur pour savoir quelles requÃªtes utiliser.

:::tip

Au lieu de pitonner l'URL de la requÃªte au complet Ã  chaque fois, ajoutez le port de votre serveur Web dans la constante `domain`, comme Ã§a vos requÃªtes ressembleront Ã  ceci :

`domain + "/api/ControllerName/ActionName"`

:::

[ğŸ’¡](/notes/rencontre8.1#-get) ImplÃ©mentez `GetAll`. Comme `Post` n'est pas encore implÃ©mentÃ©, c'est normal que l'objet JSON retournÃ© par le serveur soit une liste **vide**. Dans tous les cas, remplissez l'Ã©tat `itemList`.

<center>![GetAll](../../static/img/labo14/getAll.png)</center>

<hr/>

[ğŸ’¡](/notes/rencontre8.1#-post) En utilisant la `value` et le `name` spÃ©cifiÃ©s par lâ€™utilisateur, implÃ©mentez la requÃªte `Post`.

<center>![Post](../../static/img/labo14/post.png)</center>

Testez le `GetAll` Ã  nouveau. Si `itemList` a bien Ã©tÃ© rempli, un ou des items devraient Ãªtre visibles dans la page.

<hr/>

[ğŸ’¡](/notes/rencontre8.1#-get) En utilisant lâ€™`id` spÃ©cifiÃ© par lâ€™utilisateur, implÃ©mentez la requÃªte `Get` et glissez l'item obtenu dans l'Ã©tat `singleItem`.

<center>![Get](../../static/img/labo14/get.png)</center>

Si `singleItem` a bien Ã©tÃ© rempli, il devrait Ãªtre visible dans la page.

<hr/>

[ğŸ’¡](/notes/rencontre8.1#-put) En utilisant l'`id`, la `value` et le `name` spÃ©cifiÃ©s par l'utilisteur, implÃ©menter la requÃªte `Put` qui permettra de modifier un item existant dans la base de donnÃ©es.

<center>![Put](../../static/img/labo14/put.png)</center>

<hr/>

[ğŸ’¡](/notes/rencontre8.1#-delete) ImplÃ©mentez la requÃªte `Delete` en utilisant l'`id` fourni par l'utilisateur.

* Nâ€™oubliez pas quâ€™on a donnÃ© le type POST Ã  cette requÃªte dans notre Web API. Ã‡a veut dire quâ€™on est obligÃ©s de fournir un **corps** (un contenu en 2e paramÃ¨tre) Ã  la requÃªte HTTP. 
* Cela dit, nous nâ€™avons rien de pertinent Ã  insÃ©rer dans le **corps** (Il suffit de mettre lâ€™`id` de lâ€™item Ã  supprimer dans lâ€™URL...), donc mettez `null` comme corps. 
* Bien entendu, câ€™est normal que Ã§a ne fonctionne pas si lâ€™`id` spÃ©cifiÃ© nâ€™existe pas dans la base de donnÃ©es.

<center>![Delete](../../static/img/labo14/delete.png)</center>

:::note

Ã€ l'avenir, nous n'allons pas utiliser l'Ã©tiquette `POST` pour les actions qui permettent de supprimer des donnÃ©es. C'Ã©tait juste un test.

:::

Bravo ! Vous avez rÃ©alisÃ© une application Web *full-stack* qui respecte l'architecture `REST` ! Allez maintenant vous `reposer`.