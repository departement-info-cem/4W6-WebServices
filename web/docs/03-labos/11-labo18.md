# Laboratoire 18

<center>![Stime](../../static/img/labo16/stime.png)</center>

TÃ©lÃ©chargez les [projets de dÃ©part](../../static/files/labo16.zip). N'oubliez pas de mettre Ã  jour la base de donnÃ©es avec `dotnet ef database update`.

La gestion des utilisateurs est dÃ©jÃ  fonctionnelle et un intercepteur est dÃ©jÃ  complÃ©tÃ©. (Vous n'aurez jamais Ã  joindre token vous-mÃªmes, mais il faudra quand mÃªme Ãªtre connectÃ© !) Notez qu'il y a dÃ©jÃ  deux `reviews` existantes dans la base de donnÃ©es. Elles ont Ã©tÃ© crÃ©Ã©es par l'utilisateur `bob` dont le mot de passe est `allo`. SacrÃ© *Bob*.

Pendant le laboratoire, vous aurez **cinq requÃªtes** Ã  rendre fonctionnelles, principalement dans le `ReviewsController`.

## ğŸ”¥ Retour de flamme

Dans cette section, vous aurez Ã  complÃ©ter deux actions de `ReviewsController`. Ce sont des `reviews` qui devront Ãªtre retournÃ©es par le serveur, mais il faudra un *DisplayDTO* vu que les classes `Review` du client et du serveur sont diffÃ©rentes.

### 1 - ReviewDisplayDTO

[ğŸ’¡](/notes/rencontre9.2#-data-transfer-objects) Comparez les classes `Review.cs` (serveur) et `review.ts` (client). CrÃ©ez un *DisplayDTO* qui permettra d'envoyer au client des `Review` avec les donnÃ©es nÃ©cessaires.

### 2 - GetReview

[ğŸ’¡](/notes/rencontre9.2#-data-transfer-objects) Pour le moment, les `reviews` ne s'affichent pas dans la page Web. C'est normal, il faut implÃ©menter l'action `GetReview` d'abord. Elle va simplement rÃ©cupÃ©rer toutes les `reviews` dans la base de donnÃ©es et les convertir en `ReviewDisplayDTO` pour les envoyer au client. Une fois que ce sera fait, *dÃ©commentez* l'instruction `getReviews()` dans le `useEffect()` du composant `Home`.

<center>![Liste des reviews](../../static/img/labo16/reviews.png)</center>

### 3 - PostReview

:::warning

Pour cette requÃªte et les suivantes, vous pourriez Ãªtre agacÃ©(e)s par le fait que les notes de cours montrent des exemples **avec contrÃ´leur + service**, alors que dans ce projet, il n'y a **pas de service**. Vous devriez Ãªtre capables de rassembler toutes les opÃ©rations nÃ©cessaires dans le contrÃ´leur malgrÃ© tout. Sinon, sachez que dans le **TP3** il y aura des services, alors ces exemples vous serviront.

:::

:::info

Connectez-vous avant de poster une `Review` !

:::

[ğŸ’¡](/notes/rencontre9.2#-post) ComplÃ©tez l'action `PostReview`Â qui permettra d'ajouter un `Review` dans la base de donnÃ©es. La `Review` crÃ©Ã©e devra Ãªtre associÃ© Ã  l'auteur qui a envoyÃ© la requÃªte.

[ğŸ’¡](/notes/rencontre9.2#-data-transfer-objects) Il faudra retourner, avec `Ok(...)`, le nouveau `Review`... converti en `ReviewDisplayDTO`, bien entendu

Le code cÃ´tÃ© **Next.js** est dÃ©jÃ  complÃ©tÃ©. un **DTO** est envoyÃ© avec le texte et le nom du jeu.

<center>![CrÃ©er un review](../../static/img/labo16/post.png)</center>

## ğŸ”’ Critiques sÃ©curitaires

<center>![OpÃ©rations pour une critique](../../static/img/labo16/review1.png)</center>

### 4 - DeleteReview

[ğŸ’¡](/notes/rencontre9.2#-delete) Seul l'**auteur** d'une critique doit Ãªtre capable de la supprimer. 

Le code cÃ´tÃ© client est dÃ©jÃ  complÃ©tÃ©.

### 5 - UpvoteReview

[ğŸ’¡](/notes/rencontre9.2#-put) Seul un utilisateur authentifiÃ© **qui N'est PAS** l'auteur d'une critique doit Ãªtre capable de la _posivoter_.

Notez que si on _posivote_ une critique qu'on a **dÃ©jÃ  _posivotÃ©_**, Ã§a doit annuler / retirer notre upvote.

Le code cÃ´tÃ© client est dÃ©jÃ  complÃ©tÃ©.

### 6 - EditReview

<center>![Modifier une critique](../../static/img/labo16/review2.png)</center>

[ğŸ’¡](/notes/rencontre9.2#-put) Seul l'auteur d'une critique doit Ãªtre capable de la modifier.

[ğŸ’¡](/notes/rencontre9.2#-put) Seul le texte de la critique doit pouvoir Ãªtre modifiÃ©. (Utilisez le mÃªme **DTO** que pour `PostReview` et ignorez le nom du jeu, par exemple !)

Le code cÃ´tÃ© client est dÃ©jÃ  complÃ©tÃ©.